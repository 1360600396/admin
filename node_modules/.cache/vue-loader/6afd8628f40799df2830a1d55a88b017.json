{"remainingRequest":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\src\\views\\System\\Role\\AddRole.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\src\\views\\System\\Role\\AddRole.vue","mtime":1704167259197},{"path":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714140753088},{"path":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1714140751623},{"path":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1714140753088},{"path":"C:\\Users\\zxb\\Desktop\\黑马前端\\课件源码资料\\阶段五 Vue2+Vue3项目实战开发\\黑马智数项目-配套资料\\黑马智数项目-配套资料\\项目代码\\hmzs\\hmzs-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1714140753454}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldFRyZWVMaXN0QVBJLCBhZGRSb2xlQVBJLCBnZXRSb2xlRGV0YWlsQVBJLCB1cGRhdGVSb2xlQVBJIH0gZnJvbSAnQC9hcGkvc3lzdGVtJwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGN1cnJlbnRBY3RpdmU6IDEsCiAgICAgIHJvbGVGb3JtOiB7CiAgICAgICAgcm9sZU5hbWU6ICcnLAogICAgICAgIHJlbWFyazogJycKICAgICAgfSwKICAgICAgcm9sZVJ1bGVzOiB7CiAgICAgICAgcm9sZU5hbWU6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXop5LoibLlkI3np7AnLCB0cmlnZ2VyOiAnYmx1cicgfQogICAgICAgIF0KICAgICAgfSwKICAgICAgdHJlZUxpc3Q6IFtdLCAvLyB0cmVl5YiX6KGoCiAgICAgIGRpc2FibGVUcmVlTGlzdDogW10sIC8vIOWbnuWhq+aYvuekuueahOagkeWIl+ihqAogICAgICBwZXJtc0xpc3Q6IFtdIC8vIOWtmOWFpemAieS4remhueiKgueCuQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHJvbGVJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJvdXRlLnF1ZXJ5LnJvbGVJZAogICAgfQogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIGF3YWl0IHRoaXMuZ2V0VHJlZUxpc3QoKQogICAgaWYgKHRoaXMucm9sZUlkKSB7CiAgICAgIHRoaXMuZ2V0RGV0YWlsKCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGdldERldGFpbCgpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Um9sZURldGFpbEFQSSh0aGlzLnJvbGVJZCkKICAgICAgY29uc3QgeyBwZXJtcywgcm9sZU5hbWUsIHJlbWFyayB9ID0gcmVzLmRhdGEKICAgICAgdGhpcy5yb2xlRm9ybS5yb2xlTmFtZSA9IHJvbGVOYW1lCiAgICAgIHRoaXMucm9sZUZvcm0ucmVtYXJrID0gcmVtYXJrCiAgICAgIC8vIOWbnuWhq+agkSAgc2V0Q2hlY2tlZEtleXMKICAgICAgdGhpcy4kcmVmcy50cmVlLmZvckVhY2goKHRyZWVJbnN0YW5jZSwgaW5kZXgpID0+IHsKICAgICAgICB0cmVlSW5zdGFuY2Uuc2V0Q2hlY2tlZEtleXMocGVybXNbaW5kZXhdKQogICAgICB9KQogICAgfSwKICAgIGFzeW5jIGNvbmZpcm1BZGQoKSB7CiAgICAgIGlmICh0aGlzLnJvbGVJZCkgewogICAgICAgIGF3YWl0IHVwZGF0ZVJvbGVBUEkoewogICAgICAgICAgcm9sZUlkOiB0aGlzLnJvbGVJZCwKICAgICAgICAgIC4uLnRoaXMucm9sZUZvcm0sCiAgICAgICAgICBwZXJtczogdGhpcy5wZXJtc0xpc3QKICAgICAgICB9KQogICAgICB9IGVsc2UgewogICAgICAgIGF3YWl0IGFkZFJvbGVBUEkoewogICAgICAgICAgLi4udGhpcy5yb2xlRm9ybSwKICAgICAgICAgIHBlcm1zOiB0aGlzLnBlcm1zTGlzdAogICAgICAgIH0pCiAgICAgIH0KCiAgICAgIHRoaXMuJHJvdXRlci5iYWNrKCkKICAgIH0sCiAgICBhc3luYyBnZXRUcmVlTGlzdCgpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0VHJlZUxpc3RBUEkoKQogICAgICB0aGlzLnRyZWVMaXN0ID0gcmVzLmRhdGEKICAgICAgLy8g5ZyoZGlzYWJsZWRUcmVlTGlzdOS4reaUvuS4gOS7veaVsOaNriDlm6DkuLrmlbDnu4TmmK/lvJXnlKjnsbvlnosg5Zyo6L+b6KGM6LWL5YC855qE5pe25YCZ5a6e6ZmF5LiK6LWL5YC85piv5pWw5o2u55qE5byV55SoCiAgICAgIC8vIOS5n+WwseaYr+ivtOi/meS/qeS7veaVsOaNruWunumZheaMh+WQkeeahOaYr+WQjOS4gOS4quWGheWtmOWMuuWfn++8iOWghuWGheWtmO+8iSDkuIDkuKrkv67mlLnlj6bkuIDkuKrkuZ/kvJrlj5fliLDlvbHlk40KICAgICAgLy8g6Kej5Yaz5Yqe5rOV77ya5rex5ou36LSdCiAgICAgIHRoaXMuZGlzYWJsZVRyZWVMaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXMuZGF0YSkpCiAgICB9LAogICAgcHJldigpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudEFjdGl2ZSA9PT0gMSkgcmV0dXJuCiAgICAgIHRoaXMuY3VycmVudEFjdGl2ZS0tCiAgICB9LAogICAgbmV4dCgpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudEFjdGl2ZSA9PT0gMykgcmV0dXJuCiAgICAgIC8vIOWcqOinkuiJsuS/oeaBr+i/meS4queKtuaAgeS4iyDlgZrooajljZXmoKHpqowg5aaC5p6c5qCh6aqM6YCa6L+HIOaJjeiDvei/m+WFpeWIsOS4i+S4gOS4queKtuaAgSDvvIh0aGlzLmN1cnJlbnRBY3RpdmUrK++8iQogICAgICBpZiAodGhpcy5jdXJyZW50QWN0aXZlID09PSAxKSB7CiAgICAgICAgLy8g5aSE5Zyo6KeS6Imy5L+h5oGv54q25oCBCiAgICAgICAgdGhpcy4kcmVmcy5pbmZvRm9ybS52YWxpZGF0ZSh2YWxpZCA9PiB7CiAgICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50QWN0aXZlKysKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudEFjdGl2ZSA9PT0gMikgewogICAgICAgIC8vIOmAieaLqeadg+mZkOS/oeaBr+eahOeKtuaAgQogICAgICAgIC8vIOebruagh++8muWIpOaWreeUqOaIt+iHs+WwkemAieaLqeS6huS4gOmhuQogICAgICAgIC8vIOaAnei3rzog6I635Y+W5Yiw55So5oi36YCJ5oup5LqG5LuA5LmIIOaKiuavj+S4gOmhueeahOaVsOe7hOWxleW8gOWQiOW5tuS4uuS4gOS4quWkp+aVsOe7hCDlpoLmnpzov5nkuKrlpKfmlbDnu4Tplb/luqblpKfkuo7pm7bor4HmmI7oh7PlsJHpgInkuK3kuobkuIDpobkKICAgICAgICB0aGlzLnBlcm1zTGlzdCA9IFtdCiAgICAgICAgdGhpcy4kcmVmcy50cmVlLmZvckVhY2godHJlZUluc3RhbmNlID0+IHsKICAgICAgICAgIGNvbnN0IGtleXMgPSB0cmVlSW5zdGFuY2UuZ2V0Q2hlY2tlZEtleXMoKQogICAgICAgICAgY29uc29sZS5sb2coa2V5cykKICAgICAgICAgIHRoaXMucGVybXNMaXN0LnB1c2goa2V5cykKICAgICAgICB9KQogICAgICAgIGlmICh0aGlzLnBlcm1zTGlzdC5mbGF0KCkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAvLyDmsqHmnInpgInkuK0KICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgICBtZXNzYWdlOiAn6K+36Iez5bCR6YCJ5oup5LiA6aG5JwogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jdXJyZW50QWN0aXZlKysKICAgICAgICAgIC8vIOWbnuWhq+agkeW9oue7k+aehAogICAgICAgICAgdGhpcy4kcmVmcy5kaWFibGVkVHJlZS5mb3JFYWNoKCh0cmVlSW5zdGFuY2UsIGluZGV4KSA9PiB7CiAgICAgICAgICAgIHRyZWVJbnN0YW5jZS5zZXRDaGVja2VkS2V5cyh0aGlzLnBlcm1zTGlzdFtpbmRleF0pCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQo="},{"version":3,"sources":["AddRole.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AddRole.vue","sourceRoot":"src/views/System/Role","sourcesContent":["<template>\n  <div class=\"add-role\">\n    <header class=\"add-header\">\n      <div class=\"left\">\n        <span class=\"arrow\" @click=\"$router.back()\"><i class=\"el-icon-arrow-left\" />返回</span>\n        <span>|</span>\n        <span>添加角色</span>\n      </div>\n      <div class=\"right\">\n        黑马程序员\n      </div>\n    </header>\n    <main class=\"add-main\">\n      <div class=\"step-container\">\n        <el-steps direction=\"vertical\" :active=\"currentActive\">\n          <el-step title=\"角色信息\" />\n          <el-step title=\"权限信息\" />\n          <el-step title=\"检查并完成\" />\n        </el-steps>\n      </div>\n      <!--\n        v-if: 真实的dom创建和移除\n        v-show: 操作的只是css样式的变化  原因: 步骤切换的时候有可能回退 保证dom之前操作过的状态还在\n       -->\n      <div v-show=\"currentActive === 1\" class=\"form-container\">\n        <div class=\"title\">角色信息</div>\n        <div class=\"form\">\n          <el-form ref=\"infoForm\" class=\"form-box\" :model=\"roleForm\" :rules=\"roleRules\">\n            <el-form-item label=\"角色名称\" prop=\"roleName\">\n              <el-input v-model=\"roleForm.roleName\" />\n            </el-form-item>\n            <el-form-item label=\"角色描述\">\n              <el-input v-model=\"roleForm.remark\" />\n            </el-form-item>\n          </el-form>\n        </div>\n      </div>\n      <div v-show=\"currentActive === 2\" class=\"form-container\">\n        <div class=\"title\">权限配置</div>\n        <div class=\"form\">\n          <div class=\"tree-wrapper\">\n            <div v-for=\"item in treeList\" :key=\"item.id\" class=\"tree-item\">\n              <div class=\"tree-title\">{{ item.title }}</div>\n              <el-tree\n                ref=\"tree\"\n                :data=\"item.children\"\n                show-checkbox\n                default-expand-all\n                node-key=\"id\"\n                highlight-current\n                check-strictly\n                :props=\"{ label: 'title' }\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n      <div v-show=\"currentActive === 3\" class=\"form-container\">\n        <div class=\"title\">检查并完成</div>\n        <div class=\"form\">\n          <div class=\"info\">\n            <div class=\"form-item\">角色名称：{{ roleForm.roleName }}</div>\n            <div class=\"form-item\">角色描述：{{ roleForm.remark }}</div>\n            <div class=\"form-item\">角色权限：</div>\n            <div class=\"tree-wrapper\">\n              <div v-for=\"item in disableTreeList\" :key=\"item.id\" class=\"tree-item\">\n                <div class=\"tree-title\">{{ item.title }}</div>\n                <!--\n                  在内部通过遍历数组生成每一个树节点的时候 检测当前props选项中\n                  是否传入了一个配置项 叫做disabled 如果传入了 调用这个方法拿到它的返回值\n                  如果当前拿到的是true 就把当前项禁用掉 如果没有返回true 不禁用\n\n                  arrary.some(item=> 判断条件)\n                 -->\n                <el-tree\n                  ref=\"diabledTree\"\n                  :data=\"item.children\"\n                  show-checkbox\n                  default-expand-all\n                  check-strictly\n                  node-key=\"id\"\n                  :highlight-current=\"false\"\n                  :props=\"{ label: 'title', disabled:()=>true}\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </main>\n    <footer class=\"add-footer\">\n      <!--\n        上一步按钮 只有currentAcitve > 1 才显示\n        下一步按钮 等于3不显示\n       -->\n      <div class=\"btn-container\">\n        <el-button v-if=\"currentActive>1\" @click=\"prev\">上一步</el-button>\n        <el-button v-if=\"currentActive !== 3\" type=\"primary\" @click=\"next\">下一步</el-button>\n        <el-button v-if=\"currentActive === 3\" type=\"primary\" @click=\"confirmAdd\">确认添加</el-button>\n      </div>\n    </footer>\n  </div>\n</template>\n\n<script>\nimport { getTreeListAPI, addRoleAPI, getRoleDetailAPI, updateRoleAPI } from '@/api/system'\nexport default {\n  data() {\n    return {\n      currentActive: 1,\n      roleForm: {\n        roleName: '',\n        remark: ''\n      },\n      roleRules: {\n        roleName: [\n          { required: true, message: '请输入角色名称', trigger: 'blur' }\n        ]\n      },\n      treeList: [], // tree列表\n      disableTreeList: [], // 回填显示的树列表\n      permsList: [] // 存入选中项节点\n    }\n  },\n  computed: {\n    roleId() {\n      return this.$route.query.roleId\n    }\n  },\n  async mounted() {\n    await this.getTreeList()\n    if (this.roleId) {\n      this.getDetail()\n    }\n  },\n  methods: {\n    async getDetail() {\n      const res = await getRoleDetailAPI(this.roleId)\n      const { perms, roleName, remark } = res.data\n      this.roleForm.roleName = roleName\n      this.roleForm.remark = remark\n      // 回填树  setCheckedKeys\n      this.$refs.tree.forEach((treeInstance, index) => {\n        treeInstance.setCheckedKeys(perms[index])\n      })\n    },\n    async confirmAdd() {\n      if (this.roleId) {\n        await updateRoleAPI({\n          roleId: this.roleId,\n          ...this.roleForm,\n          perms: this.permsList\n        })\n      } else {\n        await addRoleAPI({\n          ...this.roleForm,\n          perms: this.permsList\n        })\n      }\n\n      this.$router.back()\n    },\n    async getTreeList() {\n      const res = await getTreeListAPI()\n      this.treeList = res.data\n      // 在disabledTreeList中放一份数据 因为数组是引用类型 在进行赋值的时候实际上赋值是数据的引用\n      // 也就是说这俩份数据实际指向的是同一个内存区域（堆内存） 一个修改另一个也会受到影响\n      // 解决办法：深拷贝\n      this.disableTreeList = JSON.parse(JSON.stringify(res.data))\n    },\n    prev() {\n      if (this.currentActive === 1) return\n      this.currentActive--\n    },\n    next() {\n      if (this.currentActive === 3) return\n      // 在角色信息这个状态下 做表单校验 如果校验通过 才能进入到下一个状态 （this.currentActive++）\n      if (this.currentActive === 1) {\n        // 处在角色信息状态\n        this.$refs.infoForm.validate(valid => {\n          if (valid) {\n            this.currentActive++\n          }\n        })\n      } else if (this.currentActive === 2) {\n        // 选择权限信息的状态\n        // 目标：判断用户至少选择了一项\n        // 思路: 获取到用户选择了什么 把每一项的数组展开合并为一个大数组 如果这个大数组长度大于零证明至少选中了一项\n        this.permsList = []\n        this.$refs.tree.forEach(treeInstance => {\n          const keys = treeInstance.getCheckedKeys()\n          console.log(keys)\n          this.permsList.push(keys)\n        })\n        if (this.permsList.flat().length === 0) {\n          // 没有选中\n          return this.$message({\n            type: 'warning',\n            message: '请至少选择一项'\n          })\n        } else {\n          this.currentActive++\n          // 回填树形结构\n          this.$refs.diabledTree.forEach((treeInstance, index) => {\n            treeInstance.setCheckedKeys(this.permsList[index])\n          })\n        }\n      }\n    }\n  }\n}\n</script>\n<style scoped lang=\"scss\">\n.add-role {\n  background-color: #f4f6f8;\n  height: 100vh;\n\n  .add-header {\n    display: flex;\n    justify-content: space-between;\n    padding: 0 20px;\n    height: 64px;\n    line-height: 64px;\n    font-size: 16px;\n    font-weight: bold;\n    background-color: #fff;\n\n    .left {\n      span {\n        margin-right: 4px;\n      }\n\n      .arrow {\n        cursor: pointer;\n      }\n    }\n\n    .right {\n      text-align: right;\n    }\n  }\n\n  .add-main {\n    position: fixed;\n    top: 64px;\n    bottom: 88px;\n    width: 100%;\n    overflow-y: auto;\n    background: #f4f6f8;\n    padding: 20px 230px;\n    display: flex;\n    .step-container {\n      height: 400px;\n      width: 200px;\n    }\n    .form-container {\n      flex:1;\n      background-color: #fff;\n      overflow-y: auto;\n      .title {\n        height: 60px;\n        line-height: 60px;\n        padding-left: 20px;\n      }\n      .form {\n        margin-bottom: 20px;\n        padding: 20px 65px 24px;\n        .el-form {\n          display: flex;\n          flex-wrap: wrap;\n        }\n        .info{\n          font-size:14px;\n          color:#666;\n          .form-item{\n            margin-bottom:20px;\n          }\n        }\n      }\n      .form-box{\n        width: 600px;\n        display: flex;\n        flex-direction: column;\n      }\n    }\n  }\n\n  .add-footer {\n    position: fixed;\n    bottom: 0;\n    width: 100%;\n    padding: 24px 50px;\n    color: #000000d9;\n    font-size: 14px;\n    background: #fff;\n    text-align: center;\n    z-index: 10001;\n  }\n  .tree-wrapper {\n      display: flex;\n      justify-content: space-between;\n      flex-wrap: wrap;\n      .tree-item {\n        flex: 1;\n        padding: 0px 4px;\n        text-align: center;\n        .tree-title {\n          background: #f5f7fa;\n          text-align: center;\n          padding: 10px 0;\n          margin-bottom: 12px;\n        }\n      }\n    }\n}\n</style>\n"]}]}